import{P as e,g as t,U as a}from"./PanelGroup-CmV5OZQt.js";import{s,v as o,x as r,y as n,d as l,z as i,A as p,r as d,B as m,C as c,o as u,i as f,w as y,f as v,n as g,a as h,D as _,F as b,G as x,j as k,H as j,t as w,e as T,I as C,J as B,K as N,L as S,M as A,N as E,O as U,P as I,c as M,Q as F,l as P,_ as $}from"./index-DDHcjopZ.js";import{E as z,a as R}from"./el-col-DqH3JWc6.js";import{E as G}from"./el-card-CuVKwz2M.js";import{E as J}from"./el-progress-CdMmup4U.js";import{E as O}from"./el-text-BURUbWKR.js";import"./el-tooltip-l0sNRNKZ.js";import{u as D,E as H}from"./el-popper-CKFwqsZp.js";/* empty css                   */import{_ as K}from"./Table.vue_vue_type_script_lang-DQcq6jzp.js";import{E as Q}from"./el-tag-CAhOIzri.js";import{g as q}from"./index-CSXRqvxp.js";import{g as L}from"./index-DhKCEP2y.js";import"./CountTo.vue_vue_type_script_setup_true_lang-Ci8dpQxR.js";import"./index-DXl3uH5Z.js";import"./el-checkbox-BJlhBIiO.js";import"./useInput-B8ihujou.js";import"./debounce-mfTra9hX.js";import"./el-select-C2ZuyQeW.js";import"./el-image-viewer-ELp78_NH.js";import"./tsxHelper-Cq5JD9lB.js";import"./el-dropdown-item-BKXq8FsE.js";import"./castArray-BkLeP3z1.js";import"./refs-JNELT3Rn.js";import"./index-CG0kw4Dk.js";import"./raf-efFBxEsV.js";const V=s({title:String,confirmButtonText:String,cancelButtonText:String,confirmButtonType:{type:String,values:o,default:"primary"},cancelButtonType:{type:String,values:o,default:"text"},icon:{type:r,default:()=>n},iconColor:{type:String,default:"#f90"},hideIcon:{type:Boolean,default:!1},hideAfter:{type:Number,default:200},teleported:D.teleported,persistent:D.persistent,width:{type:[String,Number],default:150}}),W={confirm:e=>e instanceof MouseEvent,cancel:e=>e instanceof MouseEvent},X=l({name:"ElPopconfirm"});const Y=A(S(l({...X,props:V,emits:W,setup(e,{emit:t}){const a=e,{t:s}=i(),o=p("popconfirm"),r=d(),n=()=>{var e,t;null==(t=null==(e=r.value)?void 0:e.onClose)||t.call(e)},l=m((()=>({width:c(a.width)}))),S=e=>{t("confirm",e),n()},A=e=>{t("cancel",e),n()},E=m((()=>a.confirmButtonText||s("el.popconfirm.confirmButtonText"))),U=m((()=>a.cancelButtonText||s("el.popconfirm.cancelButtonText")));return(e,t)=>(u(),f(h(H),N({ref_key:"tooltipRef",ref:r,trigger:"click",effect:"light"},e.$attrs,{"popper-class":`${h(o).namespace.value}-popover`,"popper-style":h(l),teleported:e.teleported,"fallback-placements":["bottom","top","right","left"],"hide-after":e.hideAfter,persistent:e.persistent}),{content:y((()=>[v("div",{class:g(h(o).b())},[v("div",{class:g(h(o).e("main"))},[!e.hideIcon&&e.icon?(u(),f(h(_),{key:0,class:g(h(o).e("icon")),style:b({color:e.iconColor})},{default:y((()=>[(u(),f(x(e.icon)))])),_:1},8,["class","style"])):k("v-if",!0),j(" "+w(e.title),1)],2),v("div",{class:g(h(o).e("action"))},[T(h(C),{size:"small",type:"text"===e.cancelButtonType?"":e.cancelButtonType,text:"text"===e.cancelButtonType,onClick:A},{default:y((()=>[j(w(h(U)),1)])),_:1},8,["type","text"]),T(h(C),{size:"small",type:"text"===e.confirmButtonType?"":e.confirmButtonType,text:"text"===e.confirmButtonType,onClick:S},{default:y((()=>[j(w(h(E)),1)])),_:1},8,["type","text"])],2)],2)])),default:y((()=>[e.$slots.reference?B(e.$slots,"reference",{key:0}):k("v-if",!0)])),_:3},16,["popper-class","popper-style","teleported","hide-after","persistent"]))}}),[["__file","popconfirm.vue"]])),Z=$(l({__name:"Analysis",setup(s){const{t:o}=P(),r=d(!0),n=E([{field:"nodeName",label:o("node.nodeName")},{field:"taskCount",label:o("node.taskCount"),formatter:(e,t,a)=>U(Q,{round:!0,effect:"dark"},(()=>a))},{field:"nodeStatus",label:o("node.nodeStatus"),formatter:(e,t,a)=>U(Q,{type:"1"===a?"success":"2"===a?"warning":"danger",effect:"dark"},(()=>o("1"==a?"node.statusRun":"2"==a?"node.statusStop":"node.statusError")))}]),l=E([{field:"name",label:o("task.taskName")},{field:"taskNum",label:o("task.taskCount"),formatter:(e,t,a)=>U(Q,{round:!0,effect:"dark"},(()=>a))},{field:"progress",label:o("task.taskProgress"),formatter:(e,t,a)=>U(J,{percentage:a,type:"line",striped:!0,status:a<100?"":"success",stripedFlow:a<100})},{field:"creatTime",label:o("task.createTime")}]),i=E([{field:"nodeName",label:o("node.nodeName")},{field:"nodeUsageCpu",label:o("node.nodeUsageCpu"),formatter:(e,t,a)=>{let s=parseFloat(a);return s=parseFloat(s.toFixed(2)),U(J,{percentage:s,type:"dashboard",color:s<50?"#26a33f":s<=80?"#fe9900":"#df2800"})}},{field:"nodeUsageMemory",label:o("node.nodeUsageMemory"),formatter:(e,t,a)=>{let s=parseFloat(a);return s=parseFloat(s.toFixed(2)),U(J,{percentage:s,type:"dashboard",color:s<50?"#26a33f":s<80?"#fe9900":"#df2800"})}}]),p=E([{field:"name",label:o("common.name")},{field:"cversion",label:o("common.cversion")},{field:"lversion",label:o("common.lversion"),formatter:(e,t,a)=>{if(e.cversion!=e.lversion){A.value=!0;const t=e.msg.split("\\n");let s="";return t.forEach((e=>{s+=`<div>${e}</div>`})),U(H,{placement:"top",content:s,rawContent:!0},[U(O,{type:"danger"},a)])}return U(O,a)}}]);let m=d([]);const c=d([]),g=async()=>{try{const e=await q();e&&e.data&&Array.isArray(e.data.list)&&(c.value=e.data.list.map((e=>({nodeName:e.name,taskCount:e.running,nodeStatus:e.state,nodeUsageCpu:e.cpuNum,nodeUsageMemory:e.memNum}))),m.value=E(e.data.list.map((e=>({nodeName:e.name,nodeUsageCpu:e.cpuNum,nodeUsageMemory:e.memNum})))))}catch(e){}finally{r.value=!1}},_=d([]),b=async()=>{const e=await L("",1,10);_.value=E(e.data.list.map((e=>({name:e.name,taskNum:e.taskNum,progress:e.progress,creatTime:e.creatTime}))))},x=d([]),B=async()=>{await Promise.all([g(),b()]),r.value=!1};(async()=>{const e=await t();x.value=E(e.data.list.map((e=>({name:e.name,cversion:e.cversion,lversion:e.lversion,msg:e.msg}))))})(),B();const N=setInterval(B,1e4);I((()=>{clearInterval(N)}));const S=async()=>{window.confirm("Are you sure you want to retest?")&&await a()},A=d(!1);return(t,a)=>(u(),M(F,null,[T(e),T(h(R),{gutter:20,justify:"space-between"},{default:y((()=>[T(h(z),{xl:12,lg:12,md:24,sm:24,xs:24},{default:y((()=>[T(h(G),{shadow:"hover",class:"mb-20px"},{header:y((()=>[v("span",null,w(h(o)("dashboard.nodeInfo")),1)])),default:y((()=>[T(h(K),{columns:n,data:c.value,stripe:"",border:!1,height:250},null,8,["columns","data"])])),_:1})])),_:1}),T(h(z),{xl:12,lg:12,md:24,sm:24,xs:24},{default:y((()=>[T(h(G),{shadow:"hover",class:"mb-20px"},{header:y((()=>[v("span",null,w(h(o)("dashboard.taskInfo")),1)])),default:y((()=>[T(h(K),{columns:l,data:_.value,stripe:"",border:!1,height:250,"tooltip-options":{offset:1,showArrow:!1,effect:"dark",enterable:!1,showAfter:0,popperOptions:{},popperClass:"test",placement:"bottom",hideAfter:0,disabled:!0}},null,8,["columns","data"])])),_:1})])),_:1}),T(h(z),{span:12},{default:y((()=>[T(h(G),{shadow:"hover",class:"mb-25px"},{header:y((()=>[v("div",null,[v("span",null,w(h(o)("node.nodeUsageStatus")),1)])])),default:y((()=>[T(h(K),{columns:i,data:h(m),highlightCurrentRow:!1,stripe:"",border:!1,height:600},null,8,["columns","data"])])),_:1})])),_:1}),T(h(z),{span:12},{default:y((()=>[T(h(G),{shadow:"hover",class:"mb-25px"},{header:y((()=>[T(h(R),null,{default:y((()=>[T(h(z),{span:12},{default:y((()=>[v("div",null,[v("span",null,w(h(o)("common.version")),1),A.value?(u(),f(h(O),{key:0,type:"danger",size:"small",style:{position:"relative",left:"1rem"}},{default:y((()=>[j("*"+w(h(o)("common.updatemsg")),1)])),_:1})):k("",!0)])])),_:1}),A.value?(u(),f(h(z),{key:0,span:3,offset:8},{default:y((()=>[T(h(Y),{title:"Are you sure?",onConfirm:S},{reference:y((()=>[T(h(C),{color:"#626aef"},{default:y((()=>[T(h(H),{content:h(o)("common.updateButtonMsg"),lacement:"top-start",effect:"dark"},{default:y((()=>[j(w(h(o)("common.update")),1)])),_:1},8,["content"])])),_:1})])),_:1})])),_:1})):k("",!0)])),_:1})])),default:y((()=>[T(h(K),{columns:p,data:x.value,stripe:"",border:!1,height:600},null,8,["columns","data"])])),_:1})])),_:1})])),_:1})],64))}}),[["__scopeId","data-v-59ee88d5"]]);export{Z as default};
