import{P as e,g as a,U as t}from"./PanelGroup-S1ekV2kW.js";import{d as s,r as o,s as r,v as l,x as n,o as d,c as m,e as i,w as p,a as u,f,t as c,i as g,y as v,j as h,z as b,F as _,l as y,_ as j}from"./index-KWTKF9N9.js";import{E as k,a as w}from"./el-col-t_F-vIr3.js";import{E as x}from"./el-card-9F69xyLv.js";import{E as N}from"./el-progress-FyGDfwQU.js";import{E as C}from"./el-text-bFj0OZ8x.js";import"./el-tooltip-w40geAFS.js";import{E as U}from"./el-popper-pnFa2Ecw.js";import{_ as A}from"./Table.vue_vue_type_script_lang-iUd8q4UT.js";import{E}from"./el-tag-MzjVikBY.js";import{g as F}from"./index-Dm_8ErkC.js";import{g as I}from"./index-8Y4g3RH2.js";import"./CountTo.vue_vue_type_script_setup_true_lang-Kj5x9Yfu.js";import"./index-XFn6QxJu.js";import"./el-checkbox-U1iRgEY7.js";import"./useInput-CGBP5_dt.js";import"./debounce-QvfGQs-0.js";import"./el-pagination-ooblyvhx.js";import"./el-image-viewer-S1bd3VyN.js";import"./tsxHelper-NOZkKkVH.js";import"./el-dropdown-item-bjCsATwt.js";import"./castArray-9Ouy5Ghy.js";import"./refs-WVQk01D0.js";import"./index-BS1c_xid.js";import"./raf-kE1zktlZ.js";const M=j(s({__name:"Analysis",setup(s){const{t:j}=y(),M=o(!0),T=r([{field:"nodeName",label:j("node.nodeName")},{field:"taskCount",label:j("node.taskCount"),formatter:(e,a,t)=>l(E,{round:!0,effect:"dark"},(()=>t))},{field:"nodeStatus",label:j("node.nodeStatus"),formatter:(e,a,t)=>l(E,{type:"1"===t?"success":"2"===t?"warning":"danger",effect:"dark"},(()=>j("1"==t?"node.statusRun":"2"==t?"node.statusStop":"node.statusError")))}]),P=r([{field:"name",label:j("task.taskName")},{field:"taskNum",label:j("task.taskCount"),formatter:(e,a,t)=>l(E,{round:!0,effect:"dark"},(()=>t))},{field:"progress",label:j("task.taskProgress"),formatter:(e,a,t)=>l(N,{percentage:t,type:"line",striped:!0,status:t<100?"":"success",stripedFlow:t<100})},{field:"creatTime",label:j("task.createTime")}]),S=r([{field:"nodeName",label:j("node.nodeName")},{field:"nodeUsageCpu",label:j("node.nodeUsageCpu"),formatter:(e,a,t)=>{let s=parseFloat(t);return s=parseFloat(s.toFixed(2)),l(N,{percentage:s,type:"dashboard",color:s<50?"#26a33f":s<=80?"#fe9900":"#df2800"})}},{field:"nodeUsageMemory",label:j("node.nodeUsageMemory"),formatter:(e,a,t)=>{let s=parseFloat(t);return s=parseFloat(s.toFixed(2)),l(N,{percentage:s,type:"dashboard",color:s<50?"#26a33f":s<80?"#fe9900":"#df2800"})}}]),H=r([{field:"name",label:j("common.name")},{field:"cversion",label:j("common.cversion")},{field:"lversion",label:j("common.lversion"),formatter:(e,a,t)=>{if(e.cversion!=e.lversion){L.value=!0;const a=e.msg.split("\\n");let s="";return a.forEach((e=>{s+=`<div>${e}</div>`})),l(U,{placement:"top",content:s,rawContent:!0},[l(C,{type:"danger"},t)])}return l(C,t)}}]);let z=o([]);const G=o([]),O=async()=>{try{const e=await F();e&&e.data&&Array.isArray(e.data.list)&&(G.value=e.data.list.map((e=>({nodeName:e.name,taskCount:e.running,nodeStatus:e.state,nodeUsageCpu:e.cpuNum,nodeUsageMemory:e.memNum}))),z.value=r(e.data.list.map((e=>({nodeName:e.name,nodeUsageCpu:e.cpuNum,nodeUsageMemory:e.memNum})))))}catch(e){}finally{M.value=!1}},R=o([]),q=async()=>{const e=await I("",1,10);R.value=r(e.data.list.map((e=>({name:e.name,taskNum:e.taskNum,progress:e.progress,creatTime:e.creatTime}))))},B=o([]),D=async()=>{await Promise.all([O(),q()]),M.value=!1};(async()=>{const e=await a();B.value=r(e.data.list.map((e=>({name:e.name,cversion:e.cversion,lversion:e.lversion,msg:e.msg}))))})(),D();const J=setInterval(D,1e4);n((()=>{clearInterval(J)}));const K=async()=>{window.confirm("Are you sure you want to retest?")&&await t()},L=o(!1);return(a,t)=>(d(),m(_,null,[i(e),i(u(w),{gutter:20,justify:"space-between"},{default:p((()=>[i(u(k),{xl:12,lg:12,md:24,sm:24,xs:24},{default:p((()=>[i(u(x),{shadow:"hover",class:"mb-20px"},{header:p((()=>[f("span",null,c(u(j)("dashboard.nodeInfo")),1)])),default:p((()=>[i(u(A),{columns:T,data:G.value,stripe:"",border:!1,height:250},null,8,["columns","data"])])),_:1})])),_:1}),i(u(k),{xl:12,lg:12,md:24,sm:24,xs:24},{default:p((()=>[i(u(x),{shadow:"hover",class:"mb-20px"},{header:p((()=>[f("span",null,c(u(j)("dashboard.taskInfo")),1)])),default:p((()=>[i(u(A),{columns:P,data:R.value,stripe:"",border:!1,height:250,"tooltip-options":{offset:1,showArrow:!1,effect:"dark",enterable:!1,showAfter:0,popperOptions:{},popperClass:"test",placement:"bottom",hideAfter:0,disabled:!0}},null,8,["columns","data"])])),_:1})])),_:1}),i(u(k),{span:12},{default:p((()=>[i(u(x),{shadow:"hover",class:"mb-25px"},{header:p((()=>[f("div",null,[f("span",null,c(u(j)("node.nodeUsageStatus")),1)])])),default:p((()=>[i(u(A),{columns:S,data:u(z),highlightCurrentRow:!1,stripe:"",border:!1,height:600},null,8,["columns","data"])])),_:1})])),_:1}),i(u(k),{span:12},{default:p((()=>[i(u(x),{shadow:"hover",class:"mb-25px"},{header:p((()=>[i(u(w),null,{default:p((()=>[i(u(k),{span:12},{default:p((()=>[f("div",null,[f("span",null,c(u(j)("common.version")),1),L.value?(d(),g(u(C),{key:0,type:"danger",size:"small",style:{position:"relative",left:"1rem"}},{default:p((()=>[v("*"+c(u(j)("common.updatemsg")),1)])),_:1})):h("",!0)])])),_:1}),L.value?(d(),g(u(k),{key:0,span:3,offset:8},{default:p((()=>[i(u(U),{content:u(j)("common.updateButtonMsg"),lacement:"top-start",effect:"dark"},{default:p((()=>[i(u(b),{color:"#626aef",onClick:K},{default:p((()=>[v(c(u(j)("common.update")),1)])),_:1})])),_:1},8,["content"])])),_:1})):h("",!0)])),_:1})])),default:p((()=>[i(u(A),{columns:H,data:B.value,stripe:"",border:!1,height:600},null,8,["columns","data"])])),_:1})])),_:1})])),_:1})],64))}}),[["__scopeId","data-v-964e2af7"]]);export{M as default};
